const search_url="http://api.jikan.moe/v3/search/anime?q=";var lazyLoadInstance=new LazyLoad({});function showResults(e,t){document.getElementById(e);let n=0;for(i in t){let s=t[i],a=s.type.toLowerCase();if(0!=a.localeCompare("special")&&0!=a.localeCompare("music")&&0!=a.localeCompare("ova")){try{if(0==s.rated.localeCompare("Rx"))continue}catch(e){}addToScreen(e,s),n++}}$.LoadingOverlay("hide"),document.getElementById("query").innerText=0==n?"No results found for '"+$("#search_input").val()+"' (Enter more than 3 letters)":"Search results found for '"+$("#search_input").val()+"'"}function addToScreen(e,t){let n=document.getElementById(e),s=document.createElement("div");s.classList.add("col"),s.classList.add("d-flex"),s.classList.add("justify-content-center"),s.classList.add("align-items-stretch"),s.classList.add("mb-4");let a=document.createAttribute("href");a.value="details.html?anime_id="+t.mal_id;let i=document.createElement("a");i.classList.add("card"),i.classList.add("shadow"),i.setAttributeNode(a),s.appendChild(i);let o=document.createAttribute("src");o.value=t.image_url;let r=document.createElement("img");r.classList.add("card-img-top"),r.classList.add("lazy"),r.setAttributeNode(o),i.appendChild(r);let d=document.createElement("div");d.classList.add("card-body"),d.classList.add("hover-this"),i.appendChild(d);let l=document.createElement("p");l.classList.add("card-title"),l.classList.add("font-size-12"),l.innerText=t.title,d.appendChild(l),n.appendChild(s)}function getSearchResults(e){if($.LoadingOverlay("show"),$("#intro_container").removeClass("display-block"),$("#intro_container").addClass("display-none"),$("#search_results_container").removeClass("display-none"),$("#search_results_container").addClass("display-block"),0==cacheCheck(e))$.get("https://api.allorigins.win/raw?url="+encodeURIComponent(e),function(t,n){sessionStorage.setItem(e,JSON.stringify(t)),showResults("result_screen",t.results)});else{showResults("result_screen",JSON.parse(sessionStorage.getItem(e)).results)}}function getTopAiring(e){$.LoadingOverlay("show"),sessionStorage.page="2",$("#intro_screen").empty(),$("#topairing_season_button").attr("disabled",!0),$("#current_season_button").removeAttr("disabled"),$("#upcoming_anime_button").removeAttr("disabled");let t=JSON.parse(getWithExpiry(e));try{showResults("intro_screen",t.top)}catch(t){$.get("https://api.allorigins.win/raw?url="+encodeURIComponent(e),function(t,n){setWithExpiry(e,JSON.stringify(t),2),showResults("intro_screen",t.top)})}}function getUpcomingAnime(e){$.LoadingOverlay("show"),sessionStorage.page="3",$("#intro_screen").empty(),$("#upcoming_anime_button").attr("disabled",!0),$("#topairing_season_button").removeAttr("disabled"),$("#current_season_button").removeAttr("disabled");let t=JSON.parse(getWithExpiry(e));try{showResults("intro_screen",t.top)}catch(t){$.get("https://api.allorigins.win/raw?url="+encodeURIComponent(e),function(t,n){setWithExpiry(e,JSON.stringify(t),2),showResults("intro_screen",t.top)})}}function getCurrentSeason(e){$.LoadingOverlay("show"),sessionStorage.page="1",$("#intro_screen").empty(),$("#current_season_button").attr("disabled",!0),$("#topairing_season_button").removeAttr("disabled"),$("#upcoming_anime_button").removeAttr("disabled");let t=JSON.parse(getWithExpiry(e));try{showResults("intro_screen",t.anime)}catch(t){$.get("https://api.allorigins.win/raw?url="+encodeURIComponent(e),function(t,n){setWithExpiry(e,JSON.stringify(t),2),showResults("intro_screen",t.anime)})}}function addToModal(e,t,n){let s=document.getElementById("news"),a=document.createElement("li");a.classList.add("media"),a.classList.add("mb-2");let i=document.createElement("div");i.classList.add("media-body"),a.appendChild(i);let o=document.createAttribute("href");o.value=t;let r=document.createElement("a");r.innerText=e,r.setAttributeNode(o),i.appendChild(r);let d=document.createElement("p");d.innerHTML=n,i.appendChild(d),s.appendChild(a)}function isValidNews(e){return!!(e=e.toLowerCase()).includes("dub")}function loadNews(){let e=!1,t=0,n="https://www.animenewsnetwork.com/news/rss.xml?ann-edition=w";if(0==cacheCheck("news_"+n))$.get("https://api.allorigins.win/raw?url="+encodeURIComponent(n),function(s,a){let i=new Map;$xml=$(s),$xml.find("item").each(function(){let n=$(this).find("title").text(),s=$(this).find("link").text(),a=$(this).find("description").text();if(isValidNews(n)){let o='{"title":"'+encodeURIComponent(n)+'", "link":"'+encodeURIComponent(s)+'", "desc":"'+encodeURIComponent(a)+'"}';i.set(t,JSON.parse(o)),addToModal(n,s,a),t++,e=!0}}),e&&(document.getElementById("news_count").innerText=t,sessionStorage.setItem("news_"+n,JSON.stringify(Array.from(i.entries()))),$("#news_btn").removeClass("display-none"),$("#news_btn").addClass("display-block"))});else{let s=new Map(JSON.parse(sessionStorage.getItem("news_"+n)));for(let[n,a]of s.entries()){e=!0,t++,addToModal(decodeURIComponent(a.title),decodeURIComponent(a.link),decodeURIComponent(a.desc))}e&&(document.getElementById("news_count").innerText=t,$("#news_btn").removeClass("display-none"),$("#news_btn").addClass("display-block"))}}function pageLoaded(){loadNews();let e=new URLSearchParams(window.location.search);if(e.has("home"))switch($("#search_results_container").removeClass("display-block"),$("#search_results_container").addClass("display-none"),$("#intro_container").removeClass("display-none"),$("#intro_container").addClass("display-block"),Number(sessionStorage.getItem("page"))){case 1:getCurrentSeason("https://api.jikan.moe/v3/season");break;case 3:getUpcomingAnime("https://api.jikan.moe/v3/top/anime/1/upcoming");break;default:getTopAiring("https://api.jikan.moe/v3/top/anime/1/airing")}else if(e.has("search"))$("#intro_container").removeClass("display-block"),$("#intro_container").addClass("display-none"),$("#search_results_container").removeClass("display-none"),$("#search_results_container").addClass("display-block"),document.getElementById("search_input").value=e.get("search"),getSearchResults(search_url+e.get("search"));else switch(Number(sessionStorage.getItem("page"))){case 1:getCurrentSeason("https://api.jikan.moe/v3/season");break;case 3:getUpcomingAnime("https://api.jikan.moe/v3/top/anime/1/upcoming");break;default:getTopAiring("https://api.jikan.moe/v3/top/anime/1/airing")}}$(document).ready(function(){$("#footer").addClass("display-none"),$("#container").imagesLoaded().always(function(e){}).done(function(e){}).fail(function(){}).progress(function(e,t){}),$("#current_season_button").click(function(){getCurrentSeason("https://api.jikan.moe/v3/season"),lazyLoadInstance.update()}),$("#topairing_season_button").click(function(){getTopAiring("https://api.jikan.moe/v3/top/anime/1/airing"),lazyLoadInstance.update()}),$("#upcoming_anime_button").click(function(){getUpcomingAnime("https://api.jikan.moe/v3/top/anime/1/upcoming"),lazyLoadInstance.update()})}),window.addEventListener("load",pageLoaded);